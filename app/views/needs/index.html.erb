<% content_for :page_title, "All needs" %>
<h1 class="page-title-with-border">All needs</h1>
<div>
  <%= form_tag("/needs", method: "get", class: "form-filter-needs form-inline add-vertical-margins") do %>
    <%= hidden_field_tag "q", params["q"] %>
    <%= label_tag "organisation_id", "Filter needs by organisation:" %>
    &nbsp;
    <%= select_tag "organisation_id",
      options_from_collection_for_select(
        Organisation.all,
        "id",
        "name_with_abbreviation_and_status",
        params[:organisation_id]
      ),
      prompt: "All organisations",
      'data-module' => 'chosen',
      class: "organisation-select" %>
    <%= submit_tag "Filter", name: nil, class: "btn btn-default if-js-hide" %>
  <% end %>
  <script>
    $('select').change(function () {
      $(this.form).submit();
    });
  </script>
</div>

<%= render partial: "collection" %>

<% unless params[:organisation_id].blank? %>
  <span><%= link_to "Export as CSV", needs_path(organisation_id: params[:organisation_id],
                                                format: :csv) %></span>
<% end %>

<%= paginate_needs @needs %>

<%= render partial: "workflow_buttons" %>
