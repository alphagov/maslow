<% content_for :page_title, "All needs" %>

<h1 class="page-header">All needs</h1>

<div>
  <%= link_to "Add a new need", new_need_path, class: "btn btn-primary" %>
  <%= form_tag("/needs", method: "get", class: "filter") do %>
    <%= label_tag "organisation_id", "Filter needs by organisation:" %>
    &nbsp;
    <%= select_tag "organisation_id",
      options_from_collection_for_select(
        Organisation.all,
        "id",
        "name_with_abbreviation",
        params[:organisation_id]
      ),
      include_blank: true,
      class: "organisation-select" %>
    <%= submit_tag "Filter", name: nil, class: "btn" %>
  <% end %>
  <%= form_tag("/needs", method: "get", class: "search") do %>
    <%= label_tag "q", "Search needs:" %>
    &nbsp;
    <%= search_field_tag("q", params["q"], class: "search-term") %>
    <%= submit_tag "Search", name: nil, class: "btn" %>
  <% end %>
</div>

<table class="table table-striped" id="needs">
  <thead>
    <tr>
      <th>Need ID</th>
      <th>I need to&hellip;</th>
      <th>Organisations</th>
    </tr>
  </thead>
  <tbody>
    <%= render partial: "need_row", collection: @needs, as: :need %>
  </tbody>
</table>

<% unless params[:organisation_id].blank? %>
  <span><%= link_to "Export as CSV", needs_path(organisation_id: params[:organisation_id],
                                                format: :csv) %></span>
<% end %>

<%= paginate_needs @needs %>

<%= render partial: "workflow_buttons", locals: { edit: false } %>
